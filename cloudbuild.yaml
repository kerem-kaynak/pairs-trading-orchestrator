steps:
- name: 'gcr.io/cloud-builders/gcloud'
  args:
  - composer
  - environments
  - storage
  - dags
  - import
  - --environment=${_COMPOSER_ENV}
  - --location=${_LOCATION}
  - --source=dags

- name: 'gcr.io/cloud-builders/gcloud'
  args:
  - composer
  - environments
  - storage
  - plugins
  - import
  - --environment=${_COMPOSER_ENV}
  - --location=${_LOCATION}
  - --source=plugins

- name: 'gcr.io/cloud-builders/gcloud'
  args:
  - composer
  - environments
  - run
  - ${_COMPOSER_ENV}
  - --location=${_LOCATION}
  - --update-pypi-packages-from-file=requirements.txt

- name: 'gcr.io/cloud-builders/gcloud'
  args:
  - composer
  - environments
  - restart
  - workers
  - ${_COMPOSER_ENV}
  - --location=${_LOCATION}

substitutions:
  _COMPOSER_ENV: 'pairs-trading-orchestrator'
  _LOCATION: 'europe-west4'

options:
  logging: CLOUD_LOGGING_ONLY